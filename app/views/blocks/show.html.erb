<div class="card border-0 shadow-sm rounded-3 p-3 mb-4">
  <div class="card-body">
    <h1 class="card-title h3 mb-4">Block: <%= @block.block_name %></h1>

    <!-- Block Details -->
    <div class="card border-0 shadow mb-4">
      <div class="card-header bg-light">
        <h2 class="h5 mb-0">Block Details</h2>
      </div>
      <div class="card-body">
        <p class="mb-1"><strong>Block Number:</strong> <%= @block.block_number %></p>
        <p class="mb-1"><strong>Block Name:</strong> <%= @block.block_name %></p>
        <p class="mb-0"><strong>Description:</strong> <%= @block.description %></p>
      </div>
    </div>

    <!-- Add Existing Part -->
    <div class="card border-0 shadow mb-4">
      <div class="card-header bg-light">
        <h2 class="h5 mb-0">Add Existing Part</h2>
      </div>
      <div class="card-body">
        <div class="custom-select mb-3">
          <input type="text" id="custom-select-input" class="form-control" placeholder="Search parts">
          <ul id="custom-select-list" class="list-group">
            <% Part.where.not(id: @block.parts.pluck(:id)).each do |part| %>
              <li class="list-group-item" data-value="<%= part.id %>"><%= "#{part.part_number} - #{part.part_name}" %></li>
            <% end %>
          </ul>
        </div>
        <%= form_with(url: add_part_block_path(@block), method: :post, local: true) do |form| %>
          <%= form.hidden_field :part_id, id: 'selected-part-id' %>
          <%= form.submit "Add Part", class: 'btn btn-outline-primary', id: 'add-part-btn', disabled: true %>
        <% end %>
      </div>
    </div>

    <!-- Related Parts -->
    <div class="card border-0 shadow mb-4">
      <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <h2 class="h5 mb-0">Related Parts</h2>
        <%= link_to 'New Part', new_block_part_path(@block), class: "btn btn-sm btn-outline-primary" %>
      </div>
      <div class="card-body p-0">
        <ul class="list-group list-group-flush">
          <% @block.parts.each do |part| %>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <%= link_to part.part_name, part, class: "text-decoration-none" %>
                <small class="text-muted d-block">Part Number: <%= part.part_number %></small>
              </div>
              <%= button_to 'Remove', remove_part_block_path(@block, part_id: part.id), method: :delete, class: "btn btn-sm btn-outline-danger", data: { confirm: 'Are you sure?' } %>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

    <!-- Related Models -->
    <div class="card border-0 shadow mb-4">
      <div class="card-header bg-light">
        <h2 class="h5 mb-0">Related Models</h2>
      </div>
      <div class="card-body p-0">
        <ul class="list-group list-group-flush">
          <% @block.models.each do |model| %>
            <li class="list-group-item">
              <%= link_to model.model_code, model, class: "text-decoration-none" %>
              <small class="text-muted d-block">Description: <%= truncate(model.description, length: 100) %></small>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

    <!-- Related Types -->
    <div class="card border-0 shadow mb-4">
      <div class="card-header bg-light">
        <h2 class="h5 mb-0">Related Types</h2>
      </div>
      <div class="card-body p-0">
        <ul class="list-group list-group-flush">
          <% @block.types.each do |type| %>
            <li class="list-group-item">
              <%= link_to type.type_name, type, class: "text-decoration-none" %>
              <small class="text-muted d-block">Type Number: <%= type.type_number %></small>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-between">
      <%= link_to 'Edit', edit_block_path(@block), class: "btn btn-outline-primary" %>
      <%= link_to 'Back to Blocks', blocks_path, class: "btn btn-outline-primary" %>
      <%= button_to 'Delete', @block, method: :delete, data: { confirm: 'Are you sure you want to delete this block?' }, class: "btn btn-outline-danger" %>
    </div>
  </div>
</div>